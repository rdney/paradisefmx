{% extends "base.html" %}
{% load i18n %}

{% block title %}{{ location.name }} - Paradise FMX{% endblock %}

{% block content %}
<div class="mb-4">
    <a href="{% url 'core:location_list' %}" class="btn btn-outline-secondary btn-lg">
        <i class="bi bi-arrow-left"></i> {% trans "Terug naar locaties" %}
    </a>
</div>

<div class="row">
    <div class="col-lg-8">
        <div class="card mb-4">
            <div class="card-header">
                <h1 class="h3 mb-0">{{ location.name }}</h1>
                {% if location.parent %}
                    <small class="text-muted">
                        <i class="bi bi-geo-alt"></i>
                        <a href="{% url 'core:location_detail' location.parent.pk %}">{{ location.parent }}</a>
                    </small>
                {% endif %}
            </div>
            <div class="card-body">
                {% if location.notes %}
                    <p>{{ location.notes|linebreaks }}</p>
                {% endif %}

                <div class="row text-center">
                    <div class="col-4">
                        <div class="fs-2 fw-bold text-primary">{{ assets|length }}</div>
                        <div class="text-muted">{% trans "Objecten" %}</div>
                    </div>
                    <div class="col-4">
                        <div class="fs-2 fw-bold text-primary">{{ repair_requests|length }}</div>
                        <div class="text-muted">{% trans "Verzoeken" %}</div>
                    </div>
                    <div class="col-4">
                        <div class="fs-2 fw-bold text-primary">{{ children|length }}</div>
                        <div class="text-muted">{% trans "Sublocaties" %}</div>
                    </div>
                </div>
            </div>
        </div>

        {% if children %}
        <div class="card mb-4">
            <div class="card-header">
                <h2 class="h4 mb-0">{% trans "Sublocaties" %}</h2>
            </div>
            <div class="list-group list-group-flush">
                {% for child in children %}
                    <a href="{% url 'core:location_detail' child.pk %}" class="list-group-item list-group-item-action">
                        <i class="bi bi-geo-alt"></i> {{ child.name }}
                    </a>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        {% if assets %}
        <div class="card mb-4">
            <div class="card-header">
                <h2 class="h4 mb-0">{% trans "Objecten" %}</h2>
            </div>
            <div class="list-group list-group-flush">
                {% for asset in assets %}
                    <a href="{% url 'assets:detail' asset.pk %}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                        <div>
                            <strong>{{ asset.asset_tag }}</strong> - {{ asset.name }}
                            <br>
                            <small class="text-muted">{{ asset.category.name|default:"-" }}</small>
                        </div>
                        <span class="badge badge-{{ asset.status }}">{{ asset.get_status_display }}</span>
                    </a>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        {% if repair_requests %}
        <div class="card mb-4">
            <div class="card-header">
                <h2 class="h4 mb-0">{% trans "Recente verzoeken" %}</h2>
            </div>
            <div class="list-group list-group-flush">
                {% for req in repair_requests %}
                    <a href="{% url 'requests:detail' req.pk %}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                        <div>
                            <span class="badge badge-{{ req.priority }} me-2">#{{ req.id }}</span>
                            <strong>{{ req.title }}</strong>
                            <br>
                            <small class="text-muted">{{ req.created_at|date:"d-m-Y" }}</small>
                        </div>
                        <span class="badge badge-{{ req.status }}">{{ req.get_status_display }}</span>
                    </a>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>

    <div class="col-lg-4">
        <div class="card mb-4">
            <div class="card-body">
                <a href="{% url 'requests:create' %}?location={{ location.pk }}" class="btn btn-primary btn-lg w-100 mb-3">
                    <i class="bi bi-plus-circle"></i> {% trans "Nieuw verzoek" %}
                </a>
                {% if user.is_staff or user.is_superuser %}
                    <a href="{% url 'core:location_update' location.pk %}" class="btn btn-outline-secondary btn-lg w-100 mb-3">
                        <i class="bi bi-pencil"></i> {% trans "Bewerken" %}
                    </a>
                    <a href="{% url 'core:location_delete' location.pk %}" class="btn btn-outline-danger btn-lg w-100">
                        <i class="bi bi-trash"></i> {% trans "Verwijderen" %}
                    </a>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
